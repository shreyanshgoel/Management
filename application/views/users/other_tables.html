<!-- Imported styles on this page -->
<link rel="stylesheet" href="{echo CDN}js/datatables/datatables.css" id="style-resource-1">
<link rel="stylesheet" href="{echo CDN}js/select2/select2-bootstrap.css" id="style-resource-2">
<link rel="stylesheet" href="{echo CDN}js/select2/select2.css" id="style-resource-3">
<script src="{echo CDN}js/datatables/datatables.js" id="script-resource-8"></script>
<script src="{echo CDN}js/select2/select2.min.js" id="script-resource-9"></script>

<ol class="breadcrumb bc-3">
    <li>
        <a href="../../dashboard/main/index">
            <i class="fa fa-home"></i>Home</a>
    </li>
    <li>
        <a href="../main/index">{if $outer == 'inventory_tables'} Inventory {/if}{if $outer == 'other_tables'} Other Tables {/if}</a>
    </li>
    <li class="active">
        <strong>{echo ucfirst($table->table_name)}</strong>
    </li>
    <div class="pull-right">
    
            <ol class="breadcrumb bc-3">
                <li>
                    <a href="/users/edit_table/{$table->id}" class="btn btn-link">Edit Table</a>
                </li>
                <li>
                    <a href="" data-toggle="modal" data-target="#myModal2" class="btn btn-link">Delete Table</a>
                </li>
                
            
            </ol>
    </div>
</ol>
<h2>{echo ucfirst($table->table_name)}</h2>

<br />
{if isset($add_operation_error)}
<div class="alert alert-danger">
    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
    <strong>Invalid operation!</strong> Try again
</div>
{/if}

{if isset($add_operation_success)}
<div class="alert alert-success">
    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
    <strong>Success!</strong> 1 Operation Added
</div>
{/if}
{if isset($delete_operation_success)}
<div class="alert alert-success">
    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
    <strong>Success!</strong> 1 Operation Deleted
</div>
{/if}

{script $s = Framework\RequestMethods::get('edit_table_success')}
{if $s == 1}
<div class="alert alert-success">
    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
    <strong>Success!</strong> Table name and columns are changed
</div>
{/if}
{if isset($delete_success)}
<div class="alert alert-success">
    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
    <strong>Success!</strong> 1 Row Deleted
</div>
{/if}
{if isset($add_row_success)}
<div class="alert alert-success">
    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
    <strong>Success!</strong>{if $number_of_rows == 1} {$number_of_rows} Rows are added {/if} {$number_of_rows} Rows are added
</div>
{/if}
{if isset($edit_success)}
<div class="alert alert-success">
    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
    <strong>Success!</strong> Your entry is edited
</div>
{/if}
<script type="text/javascript" src="{echo CDN}js/tables/tables1.js"></script>

<!--Action important-->
<form method="post" {if $outer == 'inventory_tables'} action="/users/inventory/{$table->id}" {/if} {if $outer == 'other_tables'} action="/users/other_tables/{$table->id}" {/if} enctype="multipart/form-data">
    <table class="table table-bordered datatable" id="table-1">
        <thead>
            <tr>
                {script $c = 0}

                {script $col1 = $table->column1_name}
                {script $col2 = $table->column2_name}
                {script $col3 = $table->column3_name}
                {script $col4 = $table->column4_name}
                {script $col5 = $table->column5_name}
                {script $col6 = $table->column6_name}
                {script $col7 = $table->column7_name}
                {script $col8 = $table->column8_name}
                {script $col9 = $table->column9_name}
                {script $col10 = $table->column10_name}
                
                <th>S No.</th>
                {foreach $n in $numbers}
                    {script $col = 'col' . $n}
                    {if $$col != NULL}<th>{$$col}{script $c++}</th>{/if}
                {/foreach}

                <th>Actions</th>

            </tr>
        </thead>
        <tbody id="data-body">
        
        {script $i = 1} 

        {foreach $entry in $entries}

            {script $e1 = $entry->entry1}
            {script $e2 = $entry->entry2}
            {script $e3 = $entry->entry3}
            {script $e4 = $entry->entry4}
            {script $e5 = $entry->entry5}
            {script $e6 = $entry->entry6}
            {script $e7 = $entry->entry7}
            {script $e8 = $entry->entry8}
            {script $e9 = $entry->entry9}
            {script $e10 = $entry->entry10}
            <tr>
                <td>{$i}</td>
                {foreach $n in $numbers}
                    {script $e = 'e' . $n}
                    
                        
                        {if $c >= $n}
                            {script $op = models\Operation::first(array('result_col = ?' => $n, 'table_id = ?' => $table->id))}
                            
                            {if !empty($op) && empty($$e)}
                                
                                {script $t1 = $op->o_col_1}
                                {script $t2 = $op->o_col_2}
                                {script $t3 = $op->o_col_3}
                                {script $t4 = $op->o_col_4}
                                {script $t5 = $op->o_col_5}
                                {script $t6 = $op->o_col_6}
                                {script $t7 = $op->o_col_7}
                                {script $t8 = $op->o_col_8}
                                {script $t9 = $op->o_col_9}

                                {script $o1 = $op->operation_1}
                                {script $o2 = $op->operation_2}
                                {script $o3 = $op->operation_3}
                                {script $o4 = $op->operation_4}
                                {script $o5 = $op->operation_5}
                                {script $o6 = $op->operation_6}
                                {script $o7 = $op->operation_7}
                                {script $o8 = $op->operation_8}

                                {script $temp = 'e' . $t1}

                                {script $res = $$temp}

                                {foreach $n2 in $numbers}
                                    {if $n2 == 9}
                                        {script break}
                                    {/if}
                                    {script $o = 'o' . $n2}
                                    
                                    {script $temp = $n2 + 1}
                                    
                                    {script $t = 't' . $temp}

                                    {script $t_2 = 'e' . $$t}

                                    {if $$o != -1}
                                        
                                        {if $$o == 1} {script $res = $res + $$t_2}{/if}
                                        {if $$o == 2} {script $res = $res - $$t_2}{/if}
                                        {if $$o == 3} {script $res = $res * $$t_2}{/if}
                                        {if $$o == 4} {script $res = $res / $$t_2}{/if}


                                    {/if}

                                {/foreach}
                                
                                <td>{$res}</td>

                            {/if}
                            {else}
                            
                                {if $outer == 'inventory_tables' && $n == 9} 

                                    <td>{script $total = $e3 * $e5} {$total}</td>

                                {/if}
                                {else}
                                    <td>{$$e}</td>
                                {/else}

                            {/else}
                        {/if}
            
                        
                {/foreach}
                <td>
                    <button type="button" value="{$entry->id}" data-toggle="modal" data-target="#myModal" class="edit btn btn-info btn-sm btn-icon icon-left">
                        <i class="entypo-pencil"></i> Edit
                    </button>&nbsp;&nbsp;
                    <button type="submit" name="delete" value="{$entry->id}" class="btn btn-danger btn-sm btn-icon icon-left">
                        <i class="entypo-cancel"></i> Delete
                    </button>
                </td>
            </tr>

            {script $i++}
        {/foreach}
            
        </tbody>
       
    </table>

    <br />
    <div>
        <div class="pull-left">
            <select name="" style="width:50px" class="numberofrows form-control">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
                <option value="4">4</option>
                <option value="5">5</option>
            </select>
        </div>
        &nbsp;&nbsp;
        <button type="button" class="add btn btn-primary" value="{echo $c}">
            <i class="entypo-plus"></i> Add Row
        </button>
        <div id="row-id" style="display:none">
            <input type="text" class="row-number" name="row-number" value="1"  hidden="">
        </div>


        <div class="pull-right" id="saveandcancel" style="display:none">
            <button type="submit" name="save" value="save" class="btn btn-success btn-sm btn-icon icon-left"><i class="entypo-check"></i> Save</button>
            
            <button type="button" style="margin-left:10px" class="cancel btn btn-danger btn-sm btn-icon icon-left"><i class="entypo-cancel"></i> Cancel</button>        
        </div>
    </div>
    <br>
    
    {if !empty($operations)}
        <div class="pull-left">
            Table Operations
        </div>
        
        <br>
        
        {script $i = 1}
        {foreach $o in $operations}
            <div class="pull-left">
                {script $op1 = $o->operation_1}
                {script $op2 = $o->operation_2}
                {script $op3 = $o->operation_3}
                {script $op4 = $o->operation_4}
                {script $op5 = $o->operation_5}
                {script $op6 = $o->operation_6}
                {script $op7 = $o->operation_7}
                {script $op8 = $o->operation_8}

                {script $c1 = $o->o_col_1}
                {script $c2 = $o->o_col_2}
                {script $c3 = $o->o_col_3}
                {script $c4 = $o->o_col_4}
                {script $c5 = $o->o_col_5}
                {script $c6 = $o->o_col_6}
                {script $c7 = $o->o_col_7}
                {script $c8 = $o->o_col_8}
                {script $c9 = $o->o_col_9}
                {script $c10 = $o->result_col}
                {$i}.
                {foreach $n in $numbers}
                    
                    {script $op = 'op' . $n}

                    {if $n == 9}

                        {script break}

                    {/if}

                    {if $$op != -1}

                        {script $c = 'c' . $n}
                        
                        {script $col = 'col' . $$c}
                         
                        {$$col} 

                        {if $$op == 1} + {/if}
                        {if $$op == 2} - {/if}
                        {if $$op == 3} * {/if}
                        {if $$op == 4} / {/if}
                    {/if}
                    {else}

                        {script $c = 'c' . $n}
                        
                        {script $col = 'col' . $$c}
                        
                        {$$col} = {script $col = 'col' . $c10} {$$col}
                        
                            <button type="sumbit" name="delete_operation" value="{$o->id}" style="color:red" class="btn btn-link">Delete </button>


                        {script break}
                        
                    {/else}

                {/foreach}
            </div>

            <br><br>
            {script $i++}
        {/foreach}
    
    <br>
    {/if}
    
    <div {if isset($allowed)} style="display:none" {/if}>
        
        {if $outer == 'other_tables'}

            <div class="pull-left" style="margin-top:4px">
            Number of columns?
            </div>
            <div class="pull-left">
                <select style="width:50px; margin-left:10px" name="number-of-columns" class="form-control">
                    {foreach $n in $numbers}
                        {script $col = 'col' . $n}
                        {if $$col != NULL && $n != 1 && $n != 2}
                            <option value="{echo $n-1}">{echo $n-1}</option>
                        {/if}
                    {/foreach}
                </select>
            </div>
            <button type="submit" style="margin-left:5px" name="allow-add-operation" value="add" class="btn btn-primary pull-left">
                    <i class="entypo-plus"></i> Add an operation
            </button>
        
            <br><br><br>

        {/if}

        <div class="pull-left">
            <input type="file" name="sheet">   
        </div>
        <button type="submit" style="margin-left:-50px" name="excel_add" value="add" class="btn btn-primary pull-left">
                <i class="entypo-plus"></i> Import From Excel
        </button>
    </div>

{if isset($allowed) && $outer == 'other_tables'}
    <div>
        
        {foreach $o in $numbers}

            {if $allowed > 1}
                <div class="pull-left">
                    <select name="o_col_{$o}" style="width:auto; margin-left:10px" class="form-control">
                        <option value="">Column</option>
                            {foreach $n in $numbers}
                               
                                {script $col = 'col' . $n}
            
                                {if $$col != NULL}<option value="{$n}">{$$col}</option>{/if}
                            {/foreach}
                        
                    </select>
                </div>

                <div class="pull-left">
                    <select name="o_{$o}" style="width:auto; margin-left:10px" class="form-control">
                        <option value="1">+</option>
                        <option value="2">-</option>
                        <option value="3">*</option>
                        <option value="4">/</option>
                    </select>
                </div>
                {script $allowed--}
            {/if}
            {else}
                {script break}
            {/else}
        {/foreach}

        <div class="pull-left">
            <select name="o_col_{$o}" style="width:auto; margin-left:10px" class="form-control">
                <option value="">Column</option>
                {foreach $n in $numbers}
                    {script $col = 'col' . $n}
                    {if $$col != NULL}<option value="{$n}">{$$col}</option>{/if}
                {/foreach}
            </select>
        </div>
        
        <div class="pull-left" style="margin-left:10px;margin-top:3px">
            =
        </div>

        <div class="pull-left">
            <select name="result" style="width:auto; margin-left:10px" class="form-control">
                <option value="">Column</option>
                {foreach $n in $numbers}
                    {script $col = 'col' . $n}
                    {if $$col != NULL}<option value="{$n}">{$$col}</option>{/if}
                {/foreach}
            </select>
        </div>

        &nbsp;&nbsp;
        <button type="sumbit" class="btn btn-danger pull-right" style="margin-top:10px; margin-left:10px">
            <i class="entypo-cancel"></i> Cancel
        </button>
        <button type="submit" class="btn btn-success pull-right" name="try-add-operation" value="try" style="margin-top:10px" value="{echo $c}">
            <i class="entypo-plus"></i> Add Operation
        </button>
        
    </div>

{/if}

    

<br />
<br />

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
                <h4 class="modal-title" id="myModalLabel">Edit Entry</h4>
            </div>
            <div class="modal-body">
                ...
            </div>
            <div class="modal-footer">
                <button type="submit" name="savechanges" value="save" class="btn btn-success">Save changes</button>
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <center>
            <div class="modal-content" style="margin-top:100px; width:500px">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel"></h4>
                </div>
                <div class="modal-body2">
                    <br>
                    <br>
                    <center>
                        <p>Are you sure that you want to delete this table?</p>
                    </center>
                    <br>
                    <br>
                </div>
                <div class="modal-footer">
                    <button type="submit" name="delete_table" value="{$table->id}" class="btn btn-danger">Delete</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
                </div>
            </div>
        </center>
    </div>
</div>


</form>